{% extends 'no-nav.html' %}

{% block content %}
<style>
    * {
        color: #073642;
    }

    #comparison-view {
        width: 100%;
        height: 100vh;
        position: relative;
    }

    #controls {
        background-color: #fff;
        width: 325px;
        position: fixed;
        left: 24px;
        top: 24px;
        z-index: 100;
        overflow: hidden;
        text-align: center;
        height: 200px;
        transition: all .2s ease-in-out !important;
    }

    .expander {
        border: 1px solid #e5e7e9;
        padding: 10px 18px;
        padding-bottom: 6px;
        padding-left: 14px;
        display: block;
        width: auto;
        font-size: 14px;
        border-radius: 22px;
        cursor: pointer;
        position: absolute;
        bottom: 0;
        margin: 14px auto;
        margin-top: 8px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
    }

    .expander:hover {
        background: #f8f9f9;
    }

    .expander:active {
        box-shadow: 0 0 4px rgba(0,0,0,0.1);
    }

    .closed::before {
        content: url('data:image/svg+xml; utf8, <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgb(38, 139, 210)" width="18px" height="18px"><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M15.88 9.29L12 13.17 8.12 9.29c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.39-.39.39-1.02 0-1.41-.39-.38-1.03-.39-1.42 0z"/></svg>');
        display: inline-block;
        vertical-align: top;
        margin-right: 2px;
        margin-top: 1px;
    }

    .expanded {
        height: calc(100vh - 48px) !important;
       /* content: url('data:image/svg+xml; utf8, <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgb(38, 139, 210)" width="18px" height="18px"><path d="M8.12 14.71L12 10.83l3.88 3.88c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L12.7 8.71c-.39-.39-1.02-.39-1.41 0L6.7 13.3c-.39.39-.39 1.02 0 1.41.39.38 1.03.39 1.42 0z"/></svg>');
        display: inline-block;
        vertical-align: top;
        margin-right: 2px;
        margin-top: 1px;*/
    }

    #more-settings {
        display: none;
    }

    .expanded #more-settings {
        display: block;
    }
    
    #datepicker {
        width: 125px;
        display: inline-block;
        vertical-align: top;
    }

    #datepicker input {
        width: 100%;
        line-height: 28px;
        margin-bottom: 5px;
        border-radius: 5px;
    }

    #controls .header {
        width: 100%;
        margin-bottom: 14px;
        display: block;
        height: 50px;
        line-height: 50px;;
        position: relative;
        font-weight: bold;
        color: #1F4A54;
        text-align: center;
    }

    #controls li {
        width: calc(100% - 28px);
        padding: 12px 0;
        margin: 0 auto;
        font-size: 11pt;
        color: #1F4A54;
        text-align: left;
    }

    #controls li svg {
        width: 20px;
        height: 20px;
        fill: #268BD2;
        position: relative;
        display: inline-block;
        vertical-align: top;
        margin-top: -2px;
        margin-right: 4px;
        margin-left: 4px;
    }

    #controls li select {
        float: right;
    }

    .header svg {
        width: 28px;
        height: 28px;
        fill: #1F4A54;
        line-height: 40px;
        vertical-align: middle;
        position: absolute;
        margin-top: 10px;
        left: 14px;
        cursor: pointer;
    }

    #chart {
        width: 100%;
        height: 100%;
        position: relative;
        z-index: 1;
        background-color: #f8f9f9;
        /*box-shadow: inset 7px 0 9px -7px rgba(0,0,0,0.24);*/
    }

    #nav {
        width: 100%;
        box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    }

    #logo-attribution {
        position: fixed;
        right: 24px;
        bottom: 24px;
        z-index: 100;
        filter: drop-shadow(1px 1px 1px #fff) drop-shadow(1px -1px 1px #fff) drop-shadow(-1px -1px 1px #fff) drop-shadow(-1px 1px 1px #fff);
    }

    circle:hover {
        fill: lightblue;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: none;
        shape-rendering: crispEdges;
    }

    #chart path {
        stroke: none;
    }

    #chart circle {
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        cursor: pointer;
        stroke-width: 2px;
    }

    #chart .hidden {
        visibility: hidden !important;
    }

    .line {
        fill: none;
        stroke: #e5e7e9;
        stroke-width: 4;
        shape-rendering: crispEdges;
    }

    .tooltip {
        width: auto;
        height: auto;
        min-height: 75px;
        z-index: 99;
        background: #fff;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);
        border-radius: 16px;
        font-size: 11pt;
        line-height: 150%;
        text-align: left;
        position: absolute;
        padding: 0 14px
    }

    #chart .tooltip:hover {
        visibility: visible !important;
    }

    .bottom::before {
        content: '';
        position: absolute;
        width: 32px;
        height: calc(32px + 8px);
        left: 0;
        right: 0;
        margin: 0 auto;
        top: calc(-32px - 8px);
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
    }

    .tooltip ul {
        margin-bottom: 14px;
    }

    .tooltip ul li {
        width: calc(100% - 28px);
        line-height: 150%;
        height: 48px;
        padding-bottom: 0;;
        border: 1px solid #e5e7e9;
        border-bottom: none;
        min-width: 250px;
        width: 100%;
    }

    .tooltip ul li:first-of-type {
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }

    .tooltip ul li:last-child {
        border-bottom: 1px solid #e5e7e9;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
    }

    .tooltip ul > div {
        font-weight: 500;
        vertical-align: top;
    }

    .tooltip > div {
        display: inline-block;
    }

    .tooltip li:nth-child(even) {
        background: #f8f9f9;
    }

    .tooltip li a {
        width: auto;
        display: inline-block;
        position: relative;
        height: 46px;
        overflow: hidden;
        font-size: 10pt;
        padding-right: 18px;
        line-height: 28px;
        box-sizing: border-box;
        width: 100%;
        padding-left: calc(34px + 10px + 8px);
        cursor: pointer;
        white-space: nowrap;
    }

    .tooltip .amd-branded::before {
        content: '';
        background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/AMD_Logo.svg/1200px-AMD_Logo.svg.png');
        height: 10px;
        width: 100%;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: 0 center;
        display: inline-block;
        position: absolute;
        bottom: 8px;
        left: 52px;
    }

    .tooltip .graphics-cards::after {
        content: '';
        background-image: url("{{ url_for('static', filename='/img/thumbs/gpu-generic.jpg') }}");
        height: 34px;
        width: 34px;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        left: 5px;
        top: 2px;
        position: absolute;
        margin: 5px;
        border-radius: 50%;
    }

    .tooltip ul > div::before {
        margin-right: 6px;
        margin-top: 2px;
        display: inline-block;
        vertical-align: top;
    }

    .tooltip ul > div:first-of-type::before {  
        content: url('data:image/svg+xml; utf8, <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24" fill="rgb(38, 139, 210)" width="18px" height="18px"><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><g/><g><path d="M21.65,7.65l-2.79-2.79C18.54,4.54,18,4.76,18,5.21V7H4C3.45,7,3,7.45,3,8v0c0,0.55,0.45,1,1,1h14v1.79 c0,0.45,0.54,0.67,0.85,0.35l2.79-2.79C21.84,8.16,21.84,7.84,21.65,7.65z"/><path d="M2.35,16.35l2.79,2.79C5.46,19.46,6,19.24,6,18.79V17h14c0.55,0,1-0.45,1-1v0c0-0.55-0.45-1-1-1H6v-1.79 c0-0.45-0.54-0.67-0.85-0.35l-2.79,2.79C2.16,15.84,2.16,16.16,2.35,16.35z"/></g></g></svg>');
    }

    .tooltip ul > div:last-of-type::before {  
        margin-bottom: 8px;
        content: url('data:image/svg+xml; utf8, <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgb(38, 139, 210)" width="18px" height="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 17.01V11c0-.55-.45-1-1-1s-1 .45-1 1v6.01h-1.79c-.45 0-.67.54-.35.85l2.79 2.78c.2.19.51.19.71 0l2.79-2.78c.32-.31.09-.85-.35-.85H16zM8.65 3.35L5.86 6.14c-.32.31-.1.85.35.85H8V13c0 .55.45 1 1 1s1-.45 1-1V6.99h1.79c.45 0 .67-.54.35-.85L9.35 3.35c-.19-.19-.51-.19-.7 0z"/></svg>');
    }

    .grid line {
        stroke: #fff;
        stroke-opacity: 1;
        shape-rendering: crispEdges;
        stroke-width: 2px;
    }

    .grid path {
        stroke-width: 0;
    }
</style>

<div id="comparison-view">
    <div id="controls" class="shadowed-hard round-soft">
        <div class="header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/></svg>
            Compare {{ header }}
        </div>
        <li>
            <label for="x">
                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24" fill="rgb(7, 54, 66)" width="18px" height="18px"><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><g/><g><path d="M21.65,7.65l-2.79-2.79C18.54,4.54,18,4.76,18,5.21V7H4C3.45,7,3,7.45,3,8v0c0,0.55,0.45,1,1,1h14v1.79 c0,0.45,0.54,0.67,0.85,0.35l2.79-2.79C21.84,8.16,21.84,7.84,21.65,7.65z"/><path d="M2.35,16.35l2.79,2.79C5.46,19.46,6,19.24,6,18.79V17h14c0.55,0,1-0.45,1-1v0c0-0.55-0.45-1-1-1H6v-1.79 c0-0.45-0.54-0.67-0.85-0.35l-2.79,2.79C2.16,15.84,2.16,16.16,2.35,16.35z"/></g></g></svg>
                X-Axis:
            </label>
            <select name="x" id="cars" onchange="loadChart()"></select>
        </li>
        <li>
            <label for="y">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgb(7, 54, 66)" width="18px" height="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 17.01V11c0-.55-.45-1-1-1s-1 .45-1 1v6.01h-1.79c-.45 0-.67.54-.35.85l2.79 2.78c.2.19.51.19.71 0l2.79-2.78c.32-.31.09-.85-.35-.85H16zM8.65 3.35L5.86 6.14c-.32.31-.1.85.35.85H8V13c0 .55.45 1 1 1s1-.45 1-1V6.99h1.79c.45 0 .67-.54.35-.85L9.35 3.35c-.19-.19-.51-.19-.7 0z"/></svg>
                Y-Axis:
            </label>
            <select name="y" id="cars" onchange="loadChart()"></select>
        </li>
        <div id="more-settings">
            <li style="text-align: right;">
                <label for="datepicker" style="float: left;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 4h-1V3c0-.55-.45-1-1-1s-1 .45-1 1v1H8V3c0-.55-.45-1-1-1s-1 .45-1 1v1H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 15c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1V9h14v10zM7 11h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/></svg>
                    Release date range
                </label>
                <div id="datepicker">
                    <input id="startdate"/>
                    <input id="enddate"/>
                </div>
            </li>
            <li>
                <label>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 7V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2h-8zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm9 12h-7v-2h2v-2h-2v-2h2v-2h-2V9h7c.55 0 1 .45 1 1v8c0 .55-.45 1-1 1zm-1-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></svg>
                    Brand
                </label>
                <div style="float: right;">
                    <input type="checkbox">
                </div>
            </li>
        </div>
        <a class="expander closed" onclick="toggleSettingsDrawer()">
            Specify constraints
        </a>
    </div>
    <div id="chart">
    </div>
</div>
<img id="logo-attribution" src="{{ url_for('static', filename='/img/logo.png') }}">

<script>
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="{{ url_for('static', filename='/lightpick.js') }}"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='/lightpick.css') }}">

<script>
    var picker = new Lightpick({
        field: document.querySelector('#datepicker #startdate'),
        secondField: document.querySelector('#datepicker #enddate'),
        repick: true,
        startDate: moment().startOf('month').add(7, 'day'),
        endDate: moment().add(1, 'month').endOf('month').subtract(7, 'day'),
        onSelect: function(start, end){
            var str = '';
            str += start ? start.format('Do MMMM YYYY') + ' to ' : '';
            str += end ? end.format('Do MMMM YYYY') : '...';
            document.getElementById('result-11').innerHTML = str;
        }
    });
</script> 

<script>
    let products = JSON.parse('{{ products|safe}}')
    let data = products
    let fields = Object.keys(data[0])
    let xControls = document.getElementsByName('x')[0]
    let yControls = document.getElementsByName('y')[0]

    Array.from(fields).forEach(field => {

        let option = document.createElement('OPTION')
        option.value, option.innerHTML = field

        xControls.appendChild(option.cloneNode(true))
        yControls.appendChild(option.cloneNode(true))
    })

    xControls.value = 'stream_processors'
    yControls.value = 'mem_size'
    loadChart()

    function toPlainEnglish(key, value) {

        let map = {
            'mem': 'memory',
            'perf': 'performance',
            'accel': 'accelerators',
            'trans': 'transistor',
            'interf': 'interface',
            'tbp': 'Typical Board Power',
            'd': '(Desktop)',
            'freq': 'frequency'
        }

        let english = ''
        let words = key.split('_')

        Array.from(words).forEach(word => {

            if (word in map) {

                word = map[word]
            }
            english += word + ' '
        })

        english = english.trim(' ')
        english += ': ' + value
        english = english.trim().replace(/^\w/, (c) => c.toUpperCase())

        return english
    }

    // gridlines in x axis function
    function make_x_gridlines(x) {

        return d3.axisBottom(x).ticks(5)
    }

    // gridlines in y axis function
    function make_y_gridlines(y) {

        return d3.axisLeft(y).ticks(5)
    }

    // Alleviate overplotting by merging overlapping plots into
    // "multi-plot" objects
    function consolidatePlots(arr, key1, key2) {

        let uniques = []

        arr.forEach(el => {

            let pushed = false
            uniques.forEach(uel => {

                // The current el will overlap the uel if you append it to uel
                if (el[key1] == uel[key1] && el[key2] == uel[key2]) {

                    // Check if the uel is a multiplot
                    if ('multiplot' in uel == false) {

                        // Copy the uel data into the multipart value
                        uel.multiplot = [uel]
                    }

                    // Instead of appending the element into uniques, append it to
                    // the uel multiplot field
                    uel.multiplot.push(el)
                    pushed = true
                }
            })

            if (pushed == false) {

                if(el[key1] != 'null' && el[key2] != 'null') {

                    console.log(el[key1])
                    uniques.push(el)
                }
            }
        })

        return uniques
    }

    function ensureNumeric(value) {
        //console.log(value)
        //console.log(parseInt(value))

        let number = 0
        if (Number.isNaN(parseInt(value)) == true) {

            number = 0
            //console.log(number)
        } else {

            number = parseInt(value)
            //console.log(number)
        }

        return number;
    }

    let expanded = false
    function toggleSettingsDrawer() {

        if(!expanded) {
            
            document.getElementById('controls').classList.add('expanded')
            expanded = true
        } else {

            document.getElementById('controls').classList.remove('expanded')
            expanded = false
        }
    }

    function loadChart() {


        data = consolidatePlots(data, xControls.value, yControls.value)

        const merge = (arr1, arr2, key) => {

            let sorted = [];

            while (arr1.length && arr2.length) {

                if (ensureNumeric(arr1[0][key]) < ensureNumeric(arr2[0][key])) sorted.push(arr1.shift());
                else sorted.push(arr2.shift());
            };

            return sorted.concat(arr1.slice().concat(arr2.slice()));
        };

        const mergeSort = (arr, key) => {

            if (arr.length <= 1) return arr;

            let mid = Math.floor(arr.length / 2),
                left = mergeSort(arr.slice(0, mid)),
                right = mergeSort(arr.slice(mid));

            return merge(left, right, key);
        };

        //data = mergeSort(data, yControls.value)
        //console.log(data);

        // set the dimensions and margins of the graph
        var margin = { top: 50, right: 50, bottom: 50, left: 50 },
            width = document.getElementById('chart').clientWidth - margin.left - margin.right,
            height = document.getElementById('chart').clientHeight - margin.top - margin.bottom;

        // set the ranges
        var x = d3.scaleLinear().range([0, width]);
        var y = d3.scaleLinear().range([height, 0]);

        // define the line
        var valueline = d3.line()
            .x(function (d) { return x(ensureNumeric(d[xControls.value])); })
            .y(function (d) { return y(ensureNumeric(d[yControls.value])); });

        // append the svg obgect to the body of the page
        // appends a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        document.getElementById('chart').innerHTML = ''

        /*
        var zoom = d3.zoom().on("zoom", zoomed),
            svg = d3.select("svg").call(zoom),
            g = svg.select("g"),
            image = g.select("image"),
            width = +svg.attr("width"),
            height = +svg.attr("height"),
            x0 = +image.attr("x"),
            y0 = +image.attr("y"),
            x1 = +image.attr("width") + x0,
            y1 = +image.attr("height") + y0;

        // Don’t allow the zoomed area to be bigger than the viewport.
        zoom.scaleExtent([1, Math.min(width / (x1 - x0), height / (y1 - y0))]);

        function zoomed() {
            
            var t = d3.event.transform;
            if (t.invertX(0) > x0) t.x = -x0 * t.k;
            else if (t.invertX(width) < x1) t.x = width - x1 * t.k;
            if (t.invertY(0) > y0) t.y = -y0 * t.k;
            else if (t.invertY(height) < y1) t.y = height - y1 * t.k;
            g.attr("transform", t);
        }
        */
        var svg = d3.select("#chart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g").attr("transform",
                "translate(" + margin.left + "," + margin.top + ")")

        var tooltip = d3.select("#chart")
            .append("div")
            .style("position", "absolute")
            .style("z-index", "10")
            .style("visibility", "hidden")
            .text("a simple tooltip")
            .attr('class', 'tooltip');

        // Scale the range of the data
        x.domain(d3.extent(data, function (d) { return ensureNumeric(d[xControls.value]); }));
        y.domain([0, d3.max(data, function (d) { return ensureNumeric(d[yControls.value]); })]);

        // add the X gridlines
        svg.append("g")
            .attr("class", "grid")
            .attr("transform", "translate(0," + height + ")")
            .call(make_x_gridlines(x)
                .tickSize(-height)
                .tickFormat("")
            )

        // add the Y gridlines
        svg.append("g")
            .attr("class", "grid")
            .call(make_y_gridlines(y)
                .tickSize(-width)
                .tickFormat("")
            )
        
        svg.append('defs')
            .html(`
                <linearGradient id="multi--amd-nvidia-intel" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#0071C5"/>
                    <stop offset="33%" stop-color="#76B900"/>
                    <stop offset="66%" stop-color="#76B900"/>
                    <stop offset="100%" stop-color="#ef0707"/>
                </linearGradient>`
            );
        // Add dots
        svg.append('g')
            .selectAll("dot")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function (d) { return x(ensureNumeric(d[xControls.value])); })
            .attr("cy", function (d) { return y(ensureNumeric(d[yControls.value])); })
            .attr("r", 16)
            .style("fill", "white")
            .style("opacity", "1")
            .style('stroke', function(d) {

                if(d['company'] == 'AMD') {

                    return '#000'
                }
            })
            .on("mouseover", function (d) {

                tooltip.node().classList.remove('hidden')
                tooltip.node().classList.add('bottom')
                tooltip.html('')

                let list = document.createElement('UL')

                let specs = document.createElement('DIV')
                specs.innerText += toPlainEnglish(xControls.value, d[xControls.value])
                list.appendChild(specs)

                specs = document.createElement('DIV')
                specs.innerText += toPlainEnglish(yControls.value, d[yControls.value])
                list.appendChild(specs)

                if ('multiplot' in d == false) {

                    d.multiplot = [d]
                }

                Array.from(d.multiplot).forEach(el => {

                    let product = document.createElement('A')
                    product.classList += el['company'].toLowerCase() + '-branded'
                    product.classList += ' ' + '{{ header|safe}}'.replace(' ', '-')
                    product.textContent += el['model']

                    /*
                    for(let spec in el) {

                        if([xControls.value, yControls.value].includes(spec)) {

                            product.innerHTML +=  spec + ': ' + el[spec]
                            product.innerHTML += '</br>'
                        }
                    }
                    */

                    let wrapper = document.createElement('LI')
                    wrapper.appendChild(product)
                    list.appendChild(wrapper)
                })

                tooltip.html(list.outerHTML)
                let leftCoord = event.explicitOriginalTarget.getBoundingClientRect().left + 16
                let topCoord = event.explicitOriginalTarget.getBoundingClientRect().top + 32 + 8

                return tooltip.style("visibility", "visible").style("top", (topCoord) + "px").style("left", leftCoord - (tooltip.node().clientWidth / 2) + "px");
            })
            .on("mouseout", function () {

                return tooltip.node().classList.add('hidden');
            });

        // Add the X Axis
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Add the Y Axis
        svg.append("g")
            .call(d3.axisLeft(y));
    }
</script>
{% endblock %}